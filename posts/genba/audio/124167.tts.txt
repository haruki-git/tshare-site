Python：「=」「==」「is」— None と比較の落とし穴。

基本と今回できること。

今回できるようになることは、None と比較するときに安全な書き方を理解し、等価性（==）と同一性（is）の違いを見分けられるようになることです。

 Python の代入は「=」を使い、比較は「==」で値の等しさを調べます。

 一方、「is」はオブジェクトの同一性、つまり同じオブジェクトかどうかを調べます。

 None は単一のオブジェクト（シングルトン）なので、None と比較するときは「is None」「is not None」を使うことが推奨されます。

 理由は、「== None」はクラスが __eq__ をカスタムしていると、意図しない結果になる可能性があるためです。

 ここではまず概念を押さえ、後でコードで確認します。

「=」「==」「is」の振る舞い。

「=」は代入であり、変数にオブジェクトを持たせるために使います。

 「==」は等価性の比較であり、オブジェクトが同じ値を持つかどうかを、クラスの __eq__ 実装に従って判定します。

 「is」は同一性の比較であり、同じメモリ上のオブジェクトかどうかで判定します。組み込みの不変型（数値・文字列など）は実装の最適化により同一に見える場合がありますが、これは言語仕様ではなく実装依存です。

 None は唯一のインスタンスであるため、None との比較では is を使う基準が安全です。使い分けとしては、等価性が必要なら == 、同一性が必要なら is 、None 判定は is を使うとよいです。

最小コードと実行結果。

最小コードはこちらです。

（コード例があります）

 このコードでは、None 同士は等価でも同一でもあることが表示されます。リストは値が等しくても別オブジェクトになるため、is は False になります。文字列は等価でも、実装によって is の結果が変わる場合があることが分かります。

 実行方法はこちらです。

 
 
・ファイル名を none_compare.py として保存します。
 
・ターミナルで python none_compare.py を実行するか、VSCode の Run ボタンで実行します。
 

（コード例があります）

 出力例はこちらです。

（コード例があります）

 確認方法はこちらです。

 
 
・print で各比較結果を出力して、== と is の違いを確認します。
 
・type(a) を出力して、a が NoneType であることを確認します。
 
・リストや文字列でも == と is を両方試して、結果の違いを確かめます。

デバッグ・使い分けの基準とよくあるミス。

デバッグの見方としては、print による途中結果の確認、logging モジュールでログレベルを分けた出力、pdb を使った対話的な変数確認などがあります。簡単な手順は以下です。

 
 
・比較の直前に、対象変数の repr() と type() を出力すると要チェックです。
 
・ログが必要な場合は import logging を行い、 logging.basicConfig(level=logging.DEBUG) を設定すると整理しやすいです。
 
・エディタのデバッガでブレークポイントを置き、実際の値と型を確認すると確実です。
 

 使い分けの基準は次のとおりです。

 
 
・None の判定は常に is None または is not None を使うと安全です。
 
・値の等しさを調べる場合は == を使います。
 
・同一オブジェクトかどうかを厳密に確認したい場合は is を使います。
 

 避けたい例として、None と比較するときに == を使ってしまい、クラスの __eq__ が特殊に実装されている場合に誤判定が起きることがあります。この場合は is None または is not None に置き換えると改善します。

 また、値比較に is を使ってしまい、実装依存の最適化によって誤判定になることがあります。意図が値の比較であれば == に置き換えるのがポイントです。