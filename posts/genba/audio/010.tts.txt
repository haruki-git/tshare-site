データの抽出と集計（Excel ブイビーエーやさしく解説）。

条件に合うデータの抽出方法。

今回できるようになることは、指定した条件で表を絞り込み、必要な行だけを扱えるようになることです。

 Excelでは「AutoFilter（オートフィルター）」やVisible（表示）セルの扱いを中心に考えるとわかりやすいです。

 まずは最小限で動くマクロを用意して、どこに貼るか・どう実行するかを確認します。最小マクロ：

（コード例があります）

 貼り付け場所は標準モジュール（ブイビーイーで挿入→モジュール）です。

 ファイルはマクロ有効形式（.xlsm）で保存してください。

 実行方法は、ブイビーイーでF5実行、あるいはフォームボタンに割り当てて使えます。

 確認方法は、シート上で行が絞られていることを目視で確認するか、MsgBoxの表示で実行確認ができます。

 保存形式とマクロ有効化は先に行っておくと混乱が少なくなります。

AutoFilterメソッドの使い方。

AutoFilterはRange.AutoFilterで動かし、Field（列番号）とCriteria1 スラッシュ Criteria2で条件を指定します。

 文字列、数値、日付、ワイルドカード（"*"や"?"）などを使えますし、Operator引数で複数条件をつなげられます。

 フィルター適用後はSpecialCells(xlCellTypeVisible)で見えているセルだけを扱えます。

 AutoFilter適用時には既存のAutoFilterModeを解除しておくと予期せぬ振る舞いを避けやすいです。

 フィルター後に行単位で処理する場合は、Visibleセルをループで回すか、WorksheetFunction.Subtotalで集計するのが実務的です。

Sortメソッドでデータを並べ替える。

Range.Sortを使うと、指定列で昇順や降順に並べ替えられます。

 ヘッダーを保持したい場合はHeader:=xlYesを指定し、キーにはセル参照（例：Key1:=ws.Range("B2")）を渡す点を覚えてください。

 複数キーでのソートも可能です。また、並べ替えの後にフィルターをかける場合と、フィルター後に可視セルだけを別シートにコピーする場合で、処理順を決めておく必要があります。

 RangeとCellsの使い分けは、見た目の分かりやすさで選ぶと整理しやすいです。Range("A1:B10")は固定範囲に向き、Cells(row, col)はループや動的範囲の指定に向きます。

 ValueとValue2は大差ありませんが、日付の細かい扱いではValue2の方が高速で互換性が高い場合があります。

RemoveDuplicatesで重複データを削除する。

Range.RemoveDuplicatesは、指定列の組み合わせで重複行をまとめて削除できます。

 Columns引数に配列を渡し、Header:=xlYesまたはxlNoでヘッダーの有無を指定します。

 RemoveDuplicatesは元データを上書きするため、元に戻す必要がある場面では事前にコピーを取るか、Undoが効かないことを理解しておくと安全です。

 重複判定後に集計（件数や合計）を出す場合は、RemoveDuplicates前と後で差分を取るか、コピー先で集計する構成にすると実務では扱いやすいです。

 よくあるミスとして、Field（列番号）をヘッダー行基準で間違えることが多く、原因は見た目の列位置とField番号のズレです。

 直し方は、CurrentRegionや範囲をDebug.Printで確認し、Field番号をヘッダー行から数え直すことです。