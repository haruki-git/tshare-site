Excel ブイビーエーで条件分岐をマスターする。

If文の基本構文。

今回できるようになることとして、ブイビーエーで条件を判定して処理を分岐できるようになります。

 If文は条件が真（True）のときだけ処理を行う基本の構文です。単行で書く場合は「If 条件 Then 処理」のようになり、複数行の処理を含める場合は「If 条件 Then ... End If」で囲みます。

 最小マクロ：次の例は、A1セルの値が10より大きければメッセージを出す最小の構成です。

 貼り付け場所：標準モジュールに貼り付けてください。

 実行方法：ブイビーイー（オルト プラス F11）でF5実行か、ワークシートのボタンに割り当てる方法が使えます。

 確認方法：A1に数値を入れてメッセージが出るかで確認できます。

（コード例があります）

 よくあるミスとして、条件で文字列を数値と比較して正しく動かないことが多いです。直し方は、IsNumericでチェックするかCLng スラッシュ CIntで型変換してから比較することです。

If...Then...Else文の使い方。

If...Then...Elseは条件に応じて「真の処理」と「偽の処理」を切り替えるために使います。複数の分岐が必要なときはElseIfを使うとすっきり書けます。

 ネスト（入れ子）で深く書くと可読性が落ちるため、条件が多いときは後述するSelect Caseを検討します。次は評価の段階に応じたメッセージを出す例です。

（コード例があります）

 この例はB1に数値を入れて実行して動作を確かめます。Elseブロックは「どれにも当てはまらない場合」の受け皿になります。

複数条件の組み合わせ（And、Or、Not）。

複数条件の組み合わせはAnd（かつ）、Or（または）、Not（否定）で表現します。

 条件が複雑になると何を優先するか分かりにくくなるため、括弧で優先順位を明示します。

 ブイビーエーではAndやOrは全ての式を評価するため、エラーが出る可能性がある式（ゼロ除算やNull参照）があるときは、順序に依存する実装で回避します。

 次は範囲と状態の両方を満たすときに処理する例です。

（コード例があります）

 括弧で囲むことで意図が明確になります。

 Orで複数パターンを許容する場合は、評価順と副作用の有無を考えて書くとトラブルが減ります。

Select Case文と使い分けの基準。

Select Caseは値の比較が中心で、多数の分岐を読みやすく表現できます。数値や文字列の範囲チェックにも向いています。

 使い分けの基準として、単純にTrue スラッシュ Falseで分岐するならIfを選び、値の範囲や多数の一致条件があるならSelect Caseを選ぶと可読性が上がります。

 あわせて、RangeとCells、ValueとValue2の使い分けも要チェックです。Range("A1")は複数セル操作に向き、Cells(row, col)は変数でセル参照する場合に便利です。Valueは通常の値取得で十分ですが、Value2は日付型の取り扱いがより直接的になります。

 具体例として、Select Caseでランクを振るコードを示します。

（コード例があります）

 Select Caseは範囲や複数値チェックがある場面でIfより読みやすくなります。