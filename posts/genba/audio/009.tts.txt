配列で処理を高速化する。

1次元配列の宣言と使い方。

今回できるようになることとして、1次元配列を宣言して値を入れ、セルや処理で使えるようになることを説明します。

 1次元配列はリスト状のデータ（社員名一覧や数値列など）を扱うときに便利です。

 宣言は Dim arr(1 To 5) As Variant のように範囲を決めて行い、ループで値を設定・取得します。

 配列の型は用途（整数ならLong、文字列ならString、混在やRange扱いならVariant）で変えます。

 最小マクロ：

（コード例があります）

 貼り付け場所：標準モジュール（ブイビーエーエディタの「挿入」→「標準モジュール」）に貼り付けることを推奨します。

 実行方法：ブイビーイー（Visual Basic Editor）でカーソルを置きF5実行、またはリボンにボタンを作って割り当てる方法が使いやすいです。保存はマクロ有効ブック（*.xlsm）で行ってください。

2次元配列の活用（行と列のデータ管理）。

2次元配列は表形式のデータ（行と列）をそのまま扱えるため、セルの複数列処理に向いています。

 宣言は Dim arr(1 To 3, 1 To 2) As Variant のように行と列を指定し、 arr(row, col) でアクセスします。

 For r = 1 To UBound(arr, 1) と For c = 1 To UBound(arr, 2) の二重ループで処理するのが基本です。行単位・列単位でまとめて計算する場合に効率が上がります。

 確認方法は、実行後に対象セル範囲が期待どおりに変化しているかを見ます。または MsgBox で集計結果を表示して確認できます。大きな範囲ならイミディエイトウィンドウにデバッグ出力して内容を要チェックする方法も有効です。

（コード例があります）

セル範囲と配列の相互変換。

Range.Value に配列を設定すると、Excel は自動的に 2 次元の Variant 配列として受け取ります（これが「配列←→セル範囲」の基本です）。

 逆に Range("A1:A5").Value を受け取ると 1 列×5 行の 2 次元配列になるため、1 次元に変換したい場合は Application.Transpose を使うか、自分でループしてコピーします。

 大きなデータを扱うときはセル→配列→処理→セルの順でまとめて行うと、描画やイベントのオーバーヘッドを減らせます。

 使い分けの基準：Range と Cells の使い分けは可読性と動的指定で決めます（固定範囲なら Range("A1:B10")、可変なら Cells(row, col)）です。Value と Value2 は基本ほぼ同じですが、Value2 は日付の扱いが Variant スラッシュ Double でシンプルなので、高速化向きの場面があります。

動的配列（ReDim、ReDim Preserve）。

動的配列はサイズが実行時に変わる場合に使います。 Dim arr() As Variant としてから ReDim arr(1 To n) でサイズを設定できます。

 既に値が入っている配列のサイズを変えるときは ReDim Preserve を使うとデータを保持できますが、 Preserve で拡張できるのは末尾の次元だけです。2次元配列で列数を増やすことは可能ですが、行数を増やすことはできない制約があります。

 サイズ変更は頻繁に行うとコストがかかるため、想定最大数で一度確保しておくと高速化につながります。

 よくあるミス： ReDim Preserve の使い方で、2次元配列の先頭側の次元を変えようとしてエラーになることがあります。直し方は次元の順序を見直すか、一時配列にコピーしてから再構築する方法を使います。