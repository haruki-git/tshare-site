Excel ブイビーエーでCSVファイルを扱う方法。

CSVファイルを開く方法（Workbooks.Open、QueryTables）。

今回できるようになることとして、CSVファイルをExcelで正しく開いて中身をブイビーエーで操作できるようになります。

 単純にファイルを開くなら Workbooks.Open を使うのが手軽です。区切り文字や桁区切りの扱いはローカル設定に依存するため、明示的に引数で指定するか QueryTables を使ってテキストインポートの詳細を設定すると安全です。 QueryTables は細かい列指定や文字コード指定が必要なときに便利です。

 最小マクロ：

（コード例があります）

 貼り付け場所：標準モジュールです。

 実行方法：ブイビーイー（オルト プラス F11）でマクロを選んで実行するか、シート上のボタンに割り当てて実行できます。

 確認方法：新しいブックが開くこと、または MsgBox の表示で確認します。

CSVファイルの書き出し（SaveAs xlCSV）。

CSVに保存するには、Workbook.SaveAs メソッドで FileFormat:=xlCSV を指定します。

 既存のブックを上書きする場合は要チェックで、保存前に別名で保存するかバックアップを作ると安全です。

 SaveAs はアクティブなロケールの区切りや書式の影響を受けますので、数値の区切りや日付書式が変わるケースがある点を踏まえてください。

 マクロで複数シートをCSV化する際は、対象シートをコピーして単一シートのブックにしてから SaveAs する方法が良く使われます。

文字コードの問題と対処法。

CSVでよく遭遇するのが文字コード（エンコーディング）の問題です。Excel標準の開き方ですとWindows ハイフン 31J（Shift_JIS）を期待することが多く、UTF ハイフン 8のファイルは文字化けすることがあります。

 対処法としてはQueryTablesを使ってTextFilePlatformを指定するか、外部でBOMを付ける／外す操作を行います。

 避けたい例として、UTF ハイフン 8のままWorkbooks.Openして文字化けすることが多いです。対処法はQueryTablesでTextFilePlatform:=65001を指定するか、ブイビーエーでバイナリ読み込みしてUTF ハイフン 8をExcelに渡す処理に置き換えることです。

テキストファイルの読み書き（Open、Print #、Input #）。

ブイビーエーの基本IOは Open、Print #、Input # です。Openでファイルをモード指定（For Input スラッシュ Output スラッシュ Append）で開き、Line Input # で1行ずつ読み、Print # で書き込みます。大量の行を扱う場合は、配列に格納してバッファを作り、一括で書くと高速化できます。