Excel ブイビーエー入門：基礎知識と開発環境。

ブイビーエーとは何か（マクロとの違い、できること）。

今回できるようになることとして、ブイビーエーで簡単な自動化マクロを作成して実行し、保存までできるようになります。

 ブイビーエー（Visual Basic for Applications）はExcelに組み込まれたプログラミング言語で、手作業の繰り返しや定型処理をコードで自動化できます。一般に「マクロ」はユーザーが実行する自動化処理の総称で、マクロを作る手段がブイビーエーだったり、記録機能だったりします。

 ブイビーエーではセルの読み書きや書式設定、条件分岐、ループ、外部ファイルや他のOfficeアプリとの連携まで行えます。最初は短いマクロから始めると分かりやすいです。

 使い分けの基準として、セル指定はRange("A1")が固定参照で、Cells(行,列)は繰り返し処理で便利です。Valueは値を扱う標準で、Value2は日付や通貨の扱いで差が出る場合がありますので、特に日付の細かい扱いが必要ならValue2を試すとよいです。

 最小マクロ：

（コード例があります）

 貼り付け場所：標準モジュール

ブイビーイーの起動と画面構成（プロジェクトエクスプローラ、コードウィンドウ、プロパティウィンドウ）。

ブイビーイー（Visual Basic Editor）はAlt＋F11キーで起動できます。

 起動すると左側にプロジェクトエクスプローラがあり、開いているブックやシート、モジュールが階層表示されます。中央のコードウィンドウで実際にブイビーエーコードを書き、下や右のプロパティウィンドウで選択オブジェクトの設定を確認できます。

 プロジェクトエクスプローラでは標準モジュールやシートモジュール、ThisWorkbookの違いだけ先に押さえると迷いが減ります。標準モジュールは汎用のSubやFunctionを入れる場所で、シートモジュールはそのシート固有のイベント向けです。ThisWorkbookはブック全体のイベント向けです。

 実行方法：ブイビーイーで実行（F5キーまたは実行ボタン）です。

 本文中では、コードを保存する前に要チェックとしてファイルの保存形式とマクロ有効化設定を確認するとよいです。ブイビーイー内での検索（Ctrl＋F）やステップ実行（F8）で動きを追いながら理解を深めます。

マクロの記録機能を使ってみる。

記録機能は画面操作を自動的にブイビーエーに変換してくれるため、初心者がブイビーエーの出力を学ぶのに便利です。

 開発タブの「マクロの記録」を押してから操作を行い、停止するとModuleにコードが生成されます。

 記録されたコードはSelectやActivateを多用するため、そのまま使うより不要な行を削ってシンプルにするのが実務でのコツです。

 例えば選択して太字にする手順を記録して、後で対象範囲を引数化して使えるように整形します。

 記録後はコードウィンドウで名前を付け直し、コメントを入れると読みやすくなります。

 確認方法：セルの値の変化や書式の反映、またはMsgBoxで処理が終わったことを表示して動作を確かめます。

 以下は記録コードを整理した確認用のサンプルです（選択範囲を太字・背景色設定）。

（コード例があります）

マクロ有効ブック（.xlsm）の保存方法。

マクロを含むブックは「Excel マクロ有効ブック（*.xlsm）」で保存する必要があります。通常はファイル→名前を付けて保存で保存形式を選びます。拡張子が.xlsxだとマクロが保存されないため、拡張子を確認することが重要です。

 組織のセキュリティ設定により、ブックを開いたときにマクロが無効化される場合は、信頼できる場所に置くか、署名付きマクロを使う運用が一般的です。

 プログラムから保存する例は以下のとおりで、配布用テンプレートを自動保存する場面で便利です。

（コード例があります）

 よくあるミスとして、保存形式を.xlsxにしたまま終了してマクロを失ってしまうことが多いです。直し方としては、再度マクロを含む状態で開けるなら.xlsmで上書き保存し、もし上書きで失った場合はバックアップやバージョン履歴から復元するか、再作成が必要になります。社内の保存ルールに合わせてファイル名や保存先を決めると安心です。