Excel ブイビーエー：ユーザーフォームの基礎。

ユーザーフォームの作成と表示（Show、Hide）。

今回できるようになることとして、ユーザーフォームを作成して表示や非表示を操作できるようになります。

 ブイビーイー（Visual Basic Editor）はExcelのオルト プラス F11で開き、メニューの「挿入」→「UserForm」で新しいフォームが作成できます。

 保存形式はマクロ有効ブック（.xlsm）にして、Excel上で「コンテンツの有効化」をしておく必要があります。

 フォームの表示は標準モジュールにショートマクロを書いて呼び出すのが手軽です。貼り付け場所は標準モジュール（Module1など）に表示用のサブルーチンを置くのがおすすめです。実行方法はブイビーイーでモジュールを選んでF5実行する方法、またはワークシート上にボタンを配置して割り当てる方法があります。

 最小マクロ：

（コード例があります）

コントロールの配置（テキストボックス、コマンドボタン、リストボックス、コンボボックス）。

ツールボックスからドラッグして配置し、プロパティウィンドウでNameやCaption、Text、RowSourceを設定します。

 TextBoxは自由入力、CommandButtonは処理開始、ListBoxは複数選択や一覧表示、ComboBoxはドロップダウンから選ぶ場面で使います。

 初めて作るときはNameプロパティを分かりやすく（例：txtName、btnOK、lstItems、cmbCity）にしておくと後からのコードが読みやすくなります。

 使い分けの基準として、セル指定で値を扱う場合はRange("A1")とCells(行, 列)のどちらを使うか検討します。固定セルならRangeが分かりやすく、行列を動的に扱うならCellsが扱いやすいです。

 また、値の取得ではValueとValue2がありますが、日付や通貨で精度や型を意識する場合はValue2よりValueを使うほうが直感的です（簡潔さを優先するならValue2でもよいです）。

イベントプロシージャ（Click、Initialize、Change）。

フォームやコントロールはイベントで動きます。

 UserForm_Initializeはフォームが読み込まれた直後に実行され、初期値やリストのセットに使います。CommandButtonのClickはボタン押下時、TextBoxやComboBoxのChangeは内容が変わったときに呼ばれます。

 イベント内ではMeを使って自身のコントロールにアクセスできます。以下はユーザーフォームのコード例で、Initializeでコンボを埋め、ボタンクリックで簡単な検証とシート書き込みを行います。

（コード例があります）

入力値の検証とエラーメッセージ。

ユーザー入力は必ず検証します。文字列の空白チェックはTrim、数値はIsNumeric、日付はIsDateで判定します。

 長さや桁数のチェックを加えたり、正規表現（RegExpを使う）で形式を厳密にしたりする方法もあります。

 エラー表示はMsgBoxでユーザーに分かりやすく通知し、SetFocusで該当コントロールに戻すと親切です。

 確認方法：検証後はMsgBoxの表示内容や、ワークシートの該当セルが変化していないかを確認します。

 よくあるミス：ファイルをマクロ有効形式で保存していないためにフォームやマクロが動かないことがあります。原因は.xlsxで保存してしまうことで、直し方は一度.xlsmで保存し直してから再度開き、マクロを有効化します。