<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>実践プロジェクト：請求書の自動作成</title>
  <link rel="stylesheet" href="/assets/styles.css?v=1767406624605">
</head>
<body>
  <main class="container">
    <article class="card">
      <header>
        <h1>実践プロジェクト：請求書の自動作成</h1>
        <nav><a href="/posts/VBA/">VBA記事一覧</a></nav>
        <p class="meta">投稿日：2026-01-07</p>
      </header>

      <section class="card" style="margin-top:12px;">
        <h2 style="margin:0 0 8px 0;">音声</h2>
        <audio controls preload="none" src="/posts/genba/audio/018.mp3"></audio>
        <p class="meta" style="margin-top:8px; opacity:0.85;">※ AI音声で読み上げます</p>
      </section>

      <section id="sec-toc">
        <h2>目次</h2>
        <ol>
  <li><a href="#sec-1">プロジェクトの要件定義（何を作るか）</a></li>
  <li><a href="#sec-2">テンプレートシートの準備</a></li>
  <li><a href="#sec-3">データシートから請求書への転記ロジック</a></li>
  <li><a href="#sec-4">複数の請求書を一括作成する</a></li>
  <li><a href="#sec-5">PDFで保存して完成</a></li>
  <li><a href="#sec-6">注意（ここだけ）</a></li>
  <li><a href="#sec-7">要約</a></li>
</ol>
      </section>

      <section id="sec-1">
  <h3>プロジェクトの要件定義（何を作るか）</h3>
  <p>請求データ（顧客名・請求日・金額など）がDataシートに行単位で並び、Templateシートの決まったセルへ転記してPDFで保存するマクロを作ります。</p>
<p>主要件は次のとおりです。</p>
<ul>
  <li>Data行からTemplateセルへのマッピングを定義し、空行や不完全なデータはスキップします。</li>
  <li>複数行をループ処理してPDF化し、出力先はブックと同じ場所のサブフォルダにします。</li>
  <li>ファイル命名規則（例：顧客名_yyyymmdd.pdf）を決め、xlsmでの配布を前提にします。</li>
</ul>
</section>

<section id="sec-2">
  <h3>テンプレートシートの準備</h3>
  <p>Templateシートに見た目（ロゴ、住所、明細枠）を作り、可変箇所は固定セルか名前付き範囲（例：顧客名、請求日、合計）にしておくと楽です。</p>
<p>印刷範囲（PrintArea）を設定しておくと、出力のズレを抑えやすいです。</p>
<p>テンプレートは直接上書きせず、コピーして使う運用を推奨します。</p>
<p>配布時はマクロ有効化手順を添えておきます。</p>
</section>

<section id="sec-3">
  <h3>データシートから請求書への転記ロジック</h3>
  <p>Dataシートは列ごとに項目が固定（A=顧客名、B=請求日、C=金額等）で、2行目以降に明細が並ぶ想定です。基本はForループで各行をTemplateの対応セルへ代入します。短い実例は次のとおりです。</p>

<pre><code>Sub MinimalInvoice()
    Dim wsD As Worksheet, wsT As Worksheet
    Set wsD = ThisWorkbook.Worksheets("Data")
    Set wsT = ThisWorkbook.Worksheets("Template")
    wsT.Range("B2").Value = wsD.Range("A2").Value ' 顧客名
    wsT.Range("B3").Value = wsD.Range("B2").Value ' 請求日
    wsT.Range("B4").Value = wsD.Range("C2").Value ' 金額
    MsgBox "転記完了"
End Sub</code></pre>

<p>Rangeは固定参照に向いており、Cellsはループ処理に向いています。.Valueと.Value2の違いは、日付や大きな数値を扱う場面で考慮します。</p>
</section>

<section id="sec-4">
  <h3>複数の請求書を一括作成する</h3>
  <p>Dataの最終行を取得してForループで回し、テンプレートに値を入れてPDF出力します。テンプレートを壊したくなければコピーして作業用シートを使い、出力後に削除します。代表的な一括処理例（簡略）です。</p>

<pre><code>Sub CreateInvoicesPDF()
    Dim wsD As Worksheet, wsT As Worksheet, lastRow As Long, i As Long
    Dim outFolder As String, fileName As String
    Set wsD = ThisWorkbook.Worksheets("Data")
    Set wsT = ThisWorkbook.Worksheets("Template")
    lastRow = wsD.Cells(wsD.Rows.Count, "A").End(xlUp).Row
    outFolder = ThisWorkbook.Path &amp; "\Invoices"
    If Dir(outFolder, vbDirectory) = "" Then MkDir outFolder
    For i = 2 To lastRow
        If Trim(wsD.Cells(i, "A").Value) &lt;&gt; "" Then
            wsT.Range("B2").Value = wsD.Cells(i, "A").Value
            wsT.Range("B3").Value = wsD.Cells(i, "B").Value
            wsT.Range("B4").Value = wsD.Cells(i, "C").Value
            fileName = outFolder &amp; "\" &amp; Replace(wsT.Range("B2").Value, "/", "_") &amp; "_" &amp; Format(wsT.Range("B3").Value, "yyyymmdd") &amp; ".pdf"
            wsT.ExportAsFixedFormat Type:=xlTypePDF, Filename:=fileName, IgnorePrintAreas:=False
        End If
    Next i
    MsgBox "PDF出力完了"
End Sub</code></pre>

<p>処理速度向上のため、Application.ScreenUpdating = Falseやエラー処理、ファイル名の禁則文字除去を入れてください。</p>
</section>

<section id="sec-5">
  <h3>PDFで保存して完成</h3>
  <p>ExportAsFixedFormatでPDF化し、ThisWorkbook.Path基準のサブフォルダに保存すると管理しやすいです。</p>
<p>同名ファイルの扱い（上書き／連番付与）や品質、印刷範囲（IgnorePrintAreas）などは引数で制御できます。</p>
<p>連続出力後はxlsmで保存しておくと再実行が容易です。</p>
<p>大量配布用のZIP化は外部ツールやPowerShellの併用が現実的です。</p>
</section>

<section id="sec-6">
  <h3>注意（ここだけ）</h3>
  <ul>
  <li>最小マクロ：が無効化されていると動作しないため、.xlsmで保存してマクロを有効にすることが要チェックです。また、シート名・セル参照が一致しないとエラーになるため、スペルと大文字小文字を確認することがポイントです。</li>
</ul>
</section>

      <section id="sec-7">
  <h3>要約</h3>
  <ol>
  <li>Dataシートの行をTemplateシートのセルへ転記し、PDF化するマクロを作る流れです。</li>
  <li>Templateシートは名前付き範囲と印刷範囲を設定し、原本はコピーして運用する方針です。</li>
  <li>転記はForループで行を回し、RangeとCellsを使い分けて実装する形です。</li>
  <li>ExportAsFixedFormatでPDFをThisWorkbook.Path配下に保存し、必要に応じてフォルダの自動作成も行う想定です。</li>
  <li>配布は.xlsmで行い、シート名・パス・ファイル名の整合性とマクロの有効化を事前に要チェックして運用します。</li>
</ol>
</section>
    </article>
  </main>
</body>
</html>