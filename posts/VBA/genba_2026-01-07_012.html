<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Excel VBAでCSVファイルを扱う方法</title>
  <link rel="stylesheet" href="/assets/styles.css?v=1767406624605">
</head>
<body>
  <main class="container">
    <article class="card">
      <header>
        <h1>Excel VBAでCSVファイルを扱う方法</h1>
        <nav><a href="/posts/VBA/">VBA記事一覧</a></nav>
        <p class="meta">投稿日：2026-01-07</p>
      </header>

      <section class="card" style="margin-top:12px;">
        <h2 style="margin:0 0 8px 0;">音声</h2>
        <audio controls preload="none" src="/posts/genba/audio/012.mp3"></audio>
        <p class="meta" style="margin-top:8px; opacity:0.85;">※ AI音声で読み上げます</p>
      </section>

      <section id="sec-toc">
        <h2>目次</h2>
        <ol>
  <li><a href="#sec-1">CSVファイルを開く方法（Workbooks.Open、QueryTables）</a></li>
  <li><a href="#sec-2">CSVファイルの書き出し（SaveAs xlCSV）</a></li>
  <li><a href="#sec-3">文字コードの問題と対処法</a></li>
  <li><a href="#sec-4">テキストファイルの読み書き（Open、Print #、Input #）</a></li>
  <li><a href="#sec-5">注意（ここだけ）</a></li>
</ol>
      </section>

      <section id="sec-1">
  <h3>CSVファイルを開く方法（Workbooks.Open、QueryTables）</h3>
  <p>今回できるようになることとして、CSVファイルをExcelで正しく開いて中身をVBAで操作できるようになります。</p>
<p>単純にファイルを開くなら <code>Workbooks.Open</code> を使うのが手軽です。区切り文字や桁区切りの扱いはローカル設定に依存するため、明示的に引数で指定するか <code>QueryTables</code> を使ってテキストインポートの詳細を設定すると安全です。<code>QueryTables</code> は細かい列指定や文字コード指定が必要なときに便利です。</p>
<p>最小マクロ：</p>
<pre><code>Sub OpenCSV_Min()
    Dim wb As Workbook
    ' フルパスを指定してください
    Set wb = Workbooks.Open(Filename:="C:\Data\sample.csv")
    MsgBox "開いたブック: " &amp; wb.Name
End Sub
</code></pre>
<p>貼り付け場所：標準モジュールです。</p>
<p>実行方法：VBE（Alt+F11）でマクロを選んで実行するか、シート上のボタンに割り当てて実行できます。</p>
<p>確認方法：新しいブックが開くこと、または <code>MsgBox</code> の表示で確認します。</p>
</section>

<section id="sec-2">
  <h3>CSVファイルの書き出し（SaveAs xlCSV）</h3>
  <p>CSVに保存するには、Workbook.SaveAs メソッドで FileFormat:=xlCSV を指定します。</p>
<p>既存のブックを上書きする場合は要チェックで、保存前に別名で保存するかバックアップを作ると安全です。</p>
<p>SaveAs はアクティブなロケールの区切りや書式の影響を受けますので、数値の区切りや日付書式が変わるケースがある点を踏まえてください。</p>
<p>マクロで複数シートをCSV化する際は、対象シートをコピーして単一シートのブックにしてから SaveAs する方法が良く使われます。</p>
</section>

<section id="sec-3">
  <h3>文字コードの問題と対処法</h3>
  <p>CSVでよく遭遇するのが文字コード（エンコーディング）の問題です。Excel標準の開き方ですとWindows-31J（Shift_JIS）を期待することが多く、UTF-8のファイルは文字化けすることがあります。</p>
<p>対処法としてはQueryTablesを使ってTextFilePlatformを指定するか、外部でBOMを付ける／外す操作を行います。</p>
<p>避けたい例として、UTF-8のままWorkbooks.Openして文字化けすることが多いです。対処法はQueryTablesでTextFilePlatform:=65001を指定するか、VBAでバイナリ読み込みしてUTF-8をExcelに渡す処理に置き換えることです。</p>
</section>

<section id="sec-4">
  <h3>テキストファイルの読み書き（Open、Print #、Input #）</h3>
  <p>VBAの基本IOは Open、Print #、Input # です。Openでファイルをモード指定（For Input/Output/Append）で開き、Line Input # で1行ずつ読み、Print # で書き込みます。大量の行を扱う場合は、配列に格納してバッファを作り、一括で書くと高速化できます。</p>
</section>

<section id="sec-5">
  <h3>注意（ここだけ）</h3>
  <ul>
  <li>破壊的な操作（削除・上書き・権限変更）をする前に、対象と影響範囲を確認して、必要ならバックアップを取ってから進めてください。</li>
</ul>
</section>

      
    </article>
  </main>
</body>
</html>