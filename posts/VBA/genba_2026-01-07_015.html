<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Excel VBA：ユーザーフォームの基礎</title>
  <link rel="stylesheet" href="/assets/styles.css?v=1767406624605">
</head>
<body>
  <main class="container">
    <article class="card">
      <header>
        <h1>Excel VBA：ユーザーフォームの基礎</h1>
        <nav><a href="/posts/VBA/">VBA記事一覧</a></nav>
        <p class="meta">投稿日：2026-01-07</p>
      </header>

      <section class="card" style="margin-top:12px;">
        <h2 style="margin:0 0 8px 0;">音声</h2>
        <audio controls preload="none" src="/posts/genba/audio/015.mp3"></audio>
        <p class="meta" style="margin-top:8px; opacity:0.85;">※ AI音声で読み上げます</p>
      </section>

      <section id="sec-toc">
        <h2>目次</h2>
        <ol>
  <li><a href="#sec-1">ユーザーフォームの作成と表示（Show、Hide）</a></li>
  <li><a href="#sec-2">コントロールの配置（テキストボックス、コマンドボタン、リストボックス、コンボボックス）</a></li>
  <li><a href="#sec-3">イベントプロシージャ（Click、Initialize、Change）</a></li>
  <li><a href="#sec-4">入力値の検証とエラーメッセージ</a></li>
  <li><a href="#sec-5">フォームからワークシートへのデータ登録</a></li>
  <li><a href="#sec-6">注意（ここだけ）</a></li>
  <li><a href="#sec-7">要約</a></li>
</ol>
      </section>

      <section id="sec-1">
  <h3>ユーザーフォームの作成と表示（Show、Hide）</h3>
  <p>今回できるようになることとして、ユーザーフォームを作成して表示や非表示を操作できるようになります。</p>
<p>VBE（Visual Basic Editor）はExcelのAlt+F11で開き、メニューの「挿入」→「UserForm」で新しいフォームが作成できます。</p>
<p>保存形式はマクロ有効ブック（.xlsm）にして、Excel上で「コンテンツの有効化」をしておく必要があります。</p>
<p>フォームの表示は標準モジュールにショートマクロを書いて呼び出すのが手軽です。貼り付け場所は標準モジュール（Module1など）に表示用のサブルーチンを置くのがおすすめです。実行方法はVBEでモジュールを選んでF5実行する方法、またはワークシート上にボタンを配置して割り当てる方法があります。</p>

<p>最小マクロ：</p>
<pre><code>Sub ShowSimpleForm()
    ' ユーザーフォームをモーダル表示（他の操作を止める）
    UserForm1.Show vbModal
End Sub

Sub ShowModelessForm()
    ' モードレス表示（フォームとシートが同時に操作可能）
    UserForm1.Show vbModeless
End Sub

Sub CloseFormFromModule()
    ' モジュール側からフォームを閉じる例
    Unload UserForm1
End Sub
</code></pre>
</section>

<section id="sec-2">
  <h3>コントロールの配置（テキストボックス、コマンドボタン、リストボックス、コンボボックス）</h3>
  <p>ツールボックスからドラッグして配置し、プロパティウィンドウでNameやCaption、Text、RowSourceを設定します。</p>

<p>TextBoxは自由入力、CommandButtonは処理開始、ListBoxは複数選択や一覧表示、ComboBoxはドロップダウンから選ぶ場面で使います。</p>

<p>初めて作るときはNameプロパティを分かりやすく（例：txtName、btnOK、lstItems、cmbCity）にしておくと後からのコードが読みやすくなります。</p>

<p>使い分けの基準として、セル指定で値を扱う場合はRange("A1")とCells(行, 列)のどちらを使うか検討します。固定セルならRangeが分かりやすく、行列を動的に扱うならCellsが扱いやすいです。</p>

<p>また、値の取得ではValueとValue2がありますが、日付や通貨で精度や型を意識する場合はValue2よりValueを使うほうが直感的です（簡潔さを優先するならValue2でもよいです）。</p>
</section>

<section id="sec-3">
  <h3>イベントプロシージャ（Click、Initialize、Change）</h3>
  <p>フォームやコントロールはイベントで動きます。</p>

<p>UserForm_Initializeはフォームが読み込まれた直後に実行され、初期値やリストのセットに使います。CommandButtonのClickはボタン押下時、TextBoxやComboBoxのChangeは内容が変わったときに呼ばれます。</p>

<p>イベント内ではMeを使って自身のコントロールにアクセスできます。以下はユーザーフォームのコード例で、Initializeでコンボを埋め、ボタンクリックで簡単な検証とシート書き込みを行います。</p>

<pre><code class="language-vb">' UserFormのコードモジュール内に貼る例
Private Sub UserForm_Initialize()
    Me.ComboBox1.Clear
    Me.ComboBox1.AddItem "Tokyo"
    Me.ComboBox1.AddItem "Osaka"
    Me.ListBox1.Clear
    Me.ListBox1.AddItem "OptionA"
    Me.ListBox1.AddItem "OptionB"
End Sub

Private Sub CommandButton1_Click()
    If Trim(Me.TextBox1.Value) = "" Then
        MsgBox "名前を入力してください。", vbExclamation
        Me.TextBox1.SetFocus
        Exit Sub
    End If
    ' データ登録は後のセクション参照
    Sheets("Sheet1").Cells(Rows.Count, 1).End(xlUp).Offset(1, 0).Value = Me.TextBox1.Value
    Unload Me
End Sub

Private Sub ComboBox1_Change()
    ' 選択が変わったときに他の項目を更新するなど
End Sub
</code></pre>
</section>

<section id="sec-4">
  <h3>入力値の検証とエラーメッセージ</h3>
  <p>ユーザー入力は必ず検証します。文字列の空白チェックはTrim、数値はIsNumeric、日付はIsDateで判定します。</p>
<p>長さや桁数のチェックを加えたり、正規表現（RegExpを使う）で形式を厳密にしたりする方法もあります。</p>
<p>エラー表示はMsgBoxでユーザーに分かりやすく通知し、SetFocusで該当コントロールに戻すと親切です。</p>
<p>確認方法：検証後はMsgBoxの表示内容や、ワークシートの該当セルが変化していないかを確認します。</p>
<p>よくあるミス：ファイルをマクロ有効形式で保存していないためにフォームやマクロが動かないことがあります。原因は.xlsxで保存してしまうことで、直し方は一度.xlsmで保存し直してから再度開き、マクロを有効化します。</p>
</section>

<section id="sec-5">
  <h3>フォームからワークシートへのデータ登録</h3>
  <p>フォームで集めたデータをシートに書き込む方法は単純です。</p>
<p>新しい行に追加する場合は、Columns(1)の最終行をEnd(xlUp)で見つけて、Offset(1,0)で次行を指定します。</p>
<p>複数項目を一度に書くときは、配列やVariantにして書き込むと処理が速くなります。</p>
<p>大量データなら、Application.ScreenUpdating=Falseで画面更新を止めると体感が良くなります。</p>
<p>実装時は、書き込み位置やシート名を定数化しておくと後での変更が容易です。</p>
<p>デバッグ時は、ImmediateウィンドウにDebug.Printで値を出すと状況把握が早くなります。</p>
</section>

<section id="sec-6">
  <h3>注意（ここだけ）</h3>
  <ul>
  <li>マクロの動作確認前に、ブックをマクロ有効形式（.xlsm）で保存して、Excelのセキュリティ設定でマクロを有効にしてください。</li>
</ul>
</section>

      <section id="sec-7">
  <h3>要約</h3>
  <ol>
  <li><p>VBEでUserFormを作成し、標準モジュールから<pre><code>UserForm1.Show</code></pre>で表示できます。</p></li>
  <li><p>テキストボックスやボタンは、Nameを分かりやすくしておくとコードが書きやすくなります。</p></li>
  <li><p>InitializeやClick、Changeなどのイベントで初期化やユーザー操作への反応を実装します。</p></li>
  <li><p>入力はTrimやIsNumeric、IsDateなどで検証し、MsgBoxやSetFocusでフィードバックします。</p></li>
  <li><p>シートへの登録はEnd(xlUp).Offset(1,0)などで次の行に追記し、.xlsmで保存して実行します。</p></li>
</ol>
</section>
    </article>
  </main>
</body>
</html>