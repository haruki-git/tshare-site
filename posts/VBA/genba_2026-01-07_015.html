<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ユーザーフォームの基礎（Excel VBA）</title>
  <link rel="stylesheet" href="/assets/styles.css?v=1767406624605">
</head>
<body>
  <main class="container">
    <article class="card">
      <header>
        <h1>ユーザーフォームの基礎（Excel VBA）</h1>
        <nav><a href="/posts/VBA/">VBA記事一覧</a></nav>
        <p class="meta">投稿日：2026-01-07</p>
      </header>

      <section class="card" style="margin-top:12px;">
        <h2 style="margin:0 0 8px 0;">音声</h2>
        <audio controls preload="none" src="/posts/genba/audio/015.mp3"></audio>
        <p class="meta" style="margin-top:8px; opacity:0.85;">※ AI音声で読み上げます</p>
      </section>

      <section id="sec-toc">
        <h2>目次</h2>
        <ol>
  <li><a href="#sec-1">ユーザーフォームの作成と表示（Show、Hide）</a></li>
  <li><a href="#sec-2">コントロールの配置（テキストボックス、コマンドボタン、リストボックス、コンボボックス）</a></li>
  <li><a href="#sec-3">イベントプロシージャ（Click、Initialize、Change）</a></li>
  <li><a href="#sec-4">入力値の検証とエラーメッセージ</a></li>
  <li><a href="#sec-5">注意（ここだけ）</a></li>
</ol>
      </section>

      <section id="sec-1">
  <h3>ユーザーフォームの作成と表示（Show、Hide）</h3>
  <p>今回できるようになることとして、簡単な入力フォームを作り、表示・非表示を行ってデータ受け渡しができるようになります。</p>

<p>新しいフォームはExcelでAlt+F11（VBE）を押して、挿入→UserFormで作成します。</p>

<p>フォーム表示はUserForm1.Showで行い、HideやUnloadで消すことができます。</p>

<p>ファイルはマクロ有効形式（.xlsm）で保存する必要があり、開く際にマクロを有効にするとフォームが働きます。</p>

<p>最小マクロ：以下は標準モジュールに置く最小限の表示マクロです。</p>

<pre><code>Sub ShowMyForm()
    ' フォームをモーダルで表示
    UserForm1.Show vbModal
End Sub

Sub ShowMyFormModeless()
    ' モードレス表示の例（ユーザーがシートも操作可能）
    UserForm1.Show vbModeless
End Sub
</code></pre>

<p>貼り付け場所は標準モジュールです。</p>
</section>

<section id="sec-2">
  <h3>コントロールの配置（テキストボックス、コマンドボタン、リストボックス、コンボボックス）</h3>
  <p>フォームにコントロールを置く際はツールボックスからドラッグします。テキストボックスは文字入力、コマンドボタンは処理起点、リストボックス／コンボボックスは選択肢提示に向きます。</p>

<p>レイアウトはTabIndexで入力順を整え、Nameプロパティでコード側から参照します。デザイン時にCaptionやBoundColumn（コンボの内部設定）を整えると実行時の混乱を避けられます。保存形式は前節と同じく.xlsmです。</p>

<p>フォーム側の初期化はInitializeイベントで行うことが多く、選択肢の追加はAddItemメソッドで行います。</p>

<pre><code class="language-vb">' UserForm側の例（Initializeでコンボに値を足す）
Private Sub UserForm_Initialize()
    Me.cmbCategory.AddItem "A"
    Me.cmbCategory.AddItem "B"
    Me.lstItems.AddItem "1"
    Me.lstItems.AddItem "2"
End Sub</code></pre>

<p>実行方法は、VBEでShowマクロを実行（F5）する方法か、シートにボタンを置いてAssign MacroでShowMyFormを割り当てる方法があります。</p>
</section>

<section id="sec-3">
  <h3>イベントプロシージャ（Click、Initialize、Change）</h3>
  <p>コントロールはイベントで反応します。Initializeはフォーム表示直前の設定、Clickはボタン押下、Changeはテキストや選択が変わったときに呼ばれます。</p>
<p>例えばテキストボックスのChangeで入力長を監視し、条件を満たさない場合にラベルで要チェック表示を出す構成が基本です。</p>
<p>イベント内でErrオブジェクトに頼らない簡潔な分岐を書くと保守が楽になります。</p>
<p>イベントはフォームモジュール内に自動生成されるため、そのままコードを入れることが通常です。</p>
</section>

<section id="sec-4">
  <h3>入力値の検証とエラーメッセージ</h3>
  <p>入力値は受け取り側で必ず検証します。数値であればIsNumeric、必須項目はTrimで空白を除去したうえで長さを確認し、日付はIsDateで確かめるのが基本です。</p>
<p>不正であればMsgBoxで短く理由を伝え、フォーカスを戻すと入力が続けやすくなります。例外処理はErrで捕るより、前提チェックを優先することが読みやすさにつながります。</p>
<p>よくあるミスとして、テキストの比較でOptionCompareが影響して期待どおりに動かないことがあります。この場合は、比較前にUCaseまたはLCaseで統一すると直しやすいです。</p>
<p>使い分けの基準として、RangeとCellsは複数セルや名前で指定する場合はRangeを使い、一行ずつループで動かす場合はCellsを使うと可読性が上がります。</p>
<p>Valueと</p>
</section>

<section id="sec-5">
  <h3>注意（ここだけ）</h3>
  <ul>
  <li>破壊的な操作（削除・上書き・権限変更）をする前に、対象と影響範囲を確認して、必要ならバックアップを取ってから進めてください。</li>
</ul>
</section>

      
    </article>
  </main>
</body>
</html>