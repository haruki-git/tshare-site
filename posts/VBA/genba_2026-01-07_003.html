<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Excel VBA：データ型と変数の使い方</title>
  <link rel="stylesheet" href="/assets/styles.css?v=1767406624605">
</head>
<body>
  <main class="container">
    <article class="card">
      <header>
        <h1>Excel VBA：データ型と変数の使い方</h1>
        <nav><a href="/posts/VBA/">VBA記事一覧</a></nav>
        <p class="meta">投稿日：2026-01-07</p>
      </header>

      <section class="card" style="margin-top:12px;">
        <h2 style="margin:0 0 8px 0;">音声</h2>
        <audio controls preload="none" src="/posts/genba/audio/003.mp3"></audio>
        <p class="meta" style="margin-top:8px; opacity:0.85;">※ AI音声で読み上げます</p>
      </section>

      <section id="sec-toc">
        <h2>目次</h2>
        <ol>
  <li><a href="#sec-1">主要なデータ型（String、Integer、Long、Double、Boolean、Date）</a></li>
  <li><a href="#sec-2">変数のスコープ（プロシージャレベル、モジュールレベル、パブリック）</a></li>
  <li><a href="#sec-3">定数（Const）の活用方法</a></li>
  <li><a href="#sec-4">型変換関数（CStr、CInt、CLng、CDbl）の使い分け</a></li>
  <li><a href="#sec-5">注意（ここだけ）</a></li>
  <li><a href="#sec-6">要約</a></li>
</ol>
      </section>

      <section id="sec-1">
  <h3>主要なデータ型（String、Integer、Long、Double、Boolean、Date）</h3>
  <p>今回できるようになることとして、主要なデータ型を使い分けて安全に値を扱えるようになります。</p>
<p>Excel VBAでは文字列はString、整数はInteger/Long、実数はDouble、真偽はBoolean、日付はDateとして扱います。</p>
<p>Integerは-32,768〜32,767の範囲で、行数や金額の累積がそれを超える可能性がある場合はLongを使うのが一般的です。</p>
<p>Doubleは小数の計算や統計計算向けで、誤差については浮動小数点の特徴があることを理解すると便利です。</p>
<p>Dateは内部的には数値なので計算やフォーマット変換が可能です。</p>
<p>マクロを保存する際はブックを「マクロ有効ブック（.xlsm）」で保存し、Excelの設定でマクロを有効にしてから実行することを先回りして説明します。</p>

<p>最小マクロ：</p>
<pre><code>Option Explicit

Sub 最小サンプル()
    Dim s As String
    Dim i As Integer
    Dim l As Long
    Dim d As Double
    Dim f As Boolean
    Dim dt As Date

    s = "Hello"
    i = 10
    l = 100000
    d = 3.14
    f = (i &gt; 5)
    dt = Date

    Range("A1").Value = s &amp; " " &amp; CStr(i)
    Range("A2").Value = l
    Range("A3").Value = d
    Range("A4").Value = IIf(f, "True", "False")
    Range("A5").Value = dt
End Sub
</code></pre>

<p>貼り付け場所：標準モジュール（VBEで「挿入」→「標準モジュール」）に貼り付けると扱いやすいです。</p>
<p>ThisWorkbookやシートモジュールは用途が違うため、まずは標準モジュールをおすすめします。</p>
</section>

<section id="sec-2">
  <h3>変数のスコープ（プロシージャレベル、モジュールレベル、パブリック）</h3>
  <p>プロシージャ内で宣言した変数（Dim）は、そのプロシージャ内だけで有効です（プロシージャレベル）ので、名前の衝突が起きにくくなります。</p>
<p>モジュールの先頭にDimやPrivateを置くと、そのモジュール内のすべてのプロシージャで共有できます（モジュールレベル）です。Publicで宣言するとプロジェクト全体で使えるため、複数のモジュールやシートから参照できるようになりますが、管理が難しくなるので最小限にするのが実務ではよいです。</p>
<p>例えば、処理回数を複数プロシージャで使うときはモジュールレベルやPublicを使いますが、局所的な計算用はプロシージャレベルに留めるのが混乱を避けるコツです。</p>

<p>実行方法は、VBE（Alt+F11）でマクロ名を選んでF5キーで実行するか、ワークシート上のボタンに割り当てることができます。ボタンに割り当てる場合はフォームコントロールやActiveXを使う方法がありますが、まずはVBE内で実行して動作確認するのが早いです。</p>

<pre><code class="language-vb">' モジュール先頭に記述する例（標準モジュール）
Public gCounter As Long
Private mLastRun As Date
Const VERSION As String = "1.0"

Sub 増やす()
    gCounter = gCounter + 1
    mLastRun = Now
    MsgBox "回数: " &amp; gCounter &amp; " 実行時刻: " &amp; CStr(mLastRun)
End Sub
</code></pre>
</section>

<section id="sec-3">
  <h3>定数（Const）の活用方法</h3>
  <p>定数（Const）はプログラム内で値を固定して使いたいときに有効です。税率やAPIのエンドポイント、処理の上限値などをConstで定義しておくと、後から修正箇所を探す手間が減ります。</p>
<p>定数はモジュールレベルやPublicで宣言可能で、再代入ができないため安全性が上がります。複数シートや複数モジュールで使う値はPublic Constで宣言しておくと可読性が高まります。</p>
<p>定数名は大文字とアンダースコアを混ぜた読みやすい名前にすると変更履歴が追いやすくなります。</p>
<p>確認方法：処理後にセルやMsgBoxで定数を参照している値が反映されているかを確認します。例えばA1に税抜価格、A2に税込価格を表示するなどで結果を視認できます。デバッグ中はDebug.Printでイミディエイトウィンドウに出力すると繰り返し確認が楽になります。</p>
</section>

<section id="sec-4">
  <h3>型変換関数（CStr、CInt、CLng、CDbl）の使い分け</h3>
  <p>型変換関数は入力が文字列で来る場合や、Variant型から明示的に型を変えたい場合に使います。CStrは文字列変換、CIntは整数（Integer）への変換、CLngはLongへの変換、CDblはDoubleへの変換です。数値が大きくなり得る場合はCIntでオーバーフローするリスクがあるため、CLngを使うと安全です。Doubleへの変換は小数点を保ちたい場合に使いますし、Booleanへの変換は直接CBoolを使うと明確になります。外部入力やセルの値はVariantで来ることが多いため、適切に変換してから計算に使うと型エラーを避けられます。</p>
<p>よくあるミスは、Integerで大きなカウントを扱ってオーバーフローが発生するケースです。原因はIntegerの範囲超過で、直し方は宣言をLongに変更するか、CLngで明示的に変換することです。</p>
<p>使い分けの基準は、RangeとCellsの使い分けは可読性と動的参照で判断します。セル範囲を直接指定する固定処理ならRange("A1")が読みやすく、行列をループで扱うならCells(row, col)が便利です。ValueとValue2の違いは細かい型の扱いで、Value2は日付をDoubleで返すため処理が速い一方、通貨型や日付の厳密な型を保持したいときはValueを使うと安全です。データ型そのものは、整数カウントはLong、見た目はString、少数計算はDouble、真偽判定はBoolean、日付はDateと選ぶ基準に従うと混乱が減ります。</p>
</section>

<section id="sec-5">
  <h3>注意（ここだけ）</h3>
  <ul>
  <li><p>最小マクロ：マクロを動かすにはブックを「.xlsm」で保存し、Excelの「ファイル」→「オプション」→「セキュリティセンター」→「マクロの設定」で必要に応じて有効化したうえで実行してください。</p></li>
</ul>
</section>

      <section id="sec-6">
  <h3>要約</h3>
  <ol>
  <li>String、Integer、Long、Double、Boolean、Dateは用途に応じて使い分けることが安定動作の鍵です。</li>
  <li>変数のスコープは局所化を基本にし、共有が必要な場合だけモジュールレベルやPublicを使うと管理しやすくなります。</li>
  <li>Constで変更点を集中管理すると保守性が上がります。</li>
  <li>型変換は入力の性質に合わせてCStr/CInt/CLng/CDblを使い、オーバーフローや型エラーを防ぎます。</li>
  <li>最初は標準モジュールにコードを置き、.xlsmで保存してVBEから実行し、MsgBoxやセルで結果を確認する流れを身につけると効率的です。</li>
</ol>
</section>
    </article>
  </main>
</body>
</html>